import requests
import time
import random
from datetime import datetime

SIEM_ENDPOINT = "http://localhost:5000/log"

MALWARE_EVENTS = [
    "Suspicious PowerShell command executed",
    "Executable with high entropy detected in temp folder",
    "Outbound connection to known C2 server",
    "Rundll32.exe launching unknown DLL",
    "Malicious macro activity detected in Excel"
]

def generate_malware_log():
    return {
        "log": random.choice(MALWARE_EVENTS),
        "level": "WARNING",
        "time": datetime.now().strftime("%Y-%m-%d %H:%M:%S,%f")[:-3],
        "ip": "127.0.0.1",
        "user_agent": "python-requests/2.32.3",
        "source": "malware_agent"
    }

while True:
    log = generate_malware_log()
    try:
        response = requests.post(SIEM_ENDPOINT, json=log)
        if response.status_code == 200:
            print("Malware log sent.")
        else:
            print(f"Failed to send log: {response.status_code} {response.text}")
    except Exception as e:
        print(f"Failed to send log: {e}")
    time.sleep(5)
